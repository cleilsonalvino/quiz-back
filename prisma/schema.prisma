datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Friendship {
  id          String           @id @default(uuid())
  requesterId String
  addresseeId String
  status      FriendshipStatus @default(PENDING)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  addressee   User             @relation("AddresseeFriendships", fields: [addresseeId], references: [id])
  requester   User             @relation("RequestedFriendships", fields: [requesterId], references: [id])

  @@unique([requesterId, addresseeId])
}

model User {
  id                   String    @id @default(uuid())
  email                String    @unique
  username             String    @unique
  password             String?
  birthday             DateTime?
  gender               String?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt
  score                Int       @default(0)
  pushToken            String?   @unique
  status               String    @default("Offline")
  profileImage         String?
  resetPasswordCode    String?
  resetPasswordExpires DateTime?
  googleId             String?   @unique

  perguntas            Perguntas[]  @relation("Perguntas")
  addresseeFriendships Friendship[] @relation("AddresseeFriendships")
  requestedFriendships Friendship[] @relation("RequestedFriendships")

  messagesSent     Message[] @relation("Message_fromUserIdToUser")
  messagesReceived Message[] @relation("Message_toUserIdToUser")
}

model Match {
  id              String   @id @default(uuid())
  player1Id       String
  player2Id       String
  player1Username String
  player2Username String
  category        String
  player1Score    Int
  player2Score    Int
  createdAt       DateTime @default(now())
}

model Message {
  id         String   @id @default(uuid())
  fromUserId String
  toUserId   String
  message    String
  createdAt  DateTime @default(now())
  replied    Boolean  @default(false)
  viewed     Boolean  @default(false)
  read       Boolean? @default(false)

  fromUser User @relation("Message_fromUserIdToUser", fields: [fromUserId], references: [id])
  toUser   User @relation("Message_toUserIdToUser", fields: [toUserId], references: [id])
}

model Perguntas {
  id            String   @id @default(uuid())
  question      String
  options       String[]
  correctAnswer String
  subject       String
  userId        String   @map("userId")
  user          User     @relation("Perguntas", fields: [userId], references: [id])

  categoriaPerguntasId String
  categoriaPerguntas   CategoriaPerguntas @relation("Perguntas", fields: [categoriaPerguntasId], references: [id])
}

model CategoriaPerguntas {
  id   String @id @default(uuid())
  name String

  Perguntas Perguntas[] @relation("Perguntas")
}

enum FriendshipStatus {
  PENDING
  ACCEPTED
  DECLINED
  BLOCKED
}
